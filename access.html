<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GARDA SÍOCHÁNA — Investigator Access Portal</title>
<style>
  :root{
    --bg:#07101a; --panel:#0b1620; --accent:#b71c1c; --ink:#e6eef6; --muted:#9fb3c9; --line:rgba(255,255,255,.04);
    --success:#143d2f; --danger:#3b1313;
    --input-bg:#0e2b37; /* new input background */
    --input-border:rgba(255,255,255,.07);
    --input-placeholder:rgba(230,238,246,.45);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,#061018,#07121a);color:var(--ink)}
  .wrap{max-width:820px;margin:20px auto;padding:16px}
  .banner{background:#0b0b0b;border-left:6px solid var(--accent);padding:14px 16px;font-weight:800;border-radius:8px}
  .banner small{display:block;color:var(--muted);margin-top:6px;font-weight:600}

  .panel{background:linear-gradient(180deg,rgba(255,255,255,.01),rgba(255,255,255,.00));border:1px solid var(--line);border-radius:12px;padding:16px;margin-top:16px}
  h1{margin:0;font-size:18px}
  p.lead{color:var(--muted);margin:8px 0 14px;line-height:1.4}

  /* layout */
  .two-col{display:grid;grid-template-columns:1fr 320px;gap:16px;align-items:start}
  @media (max-width:900px){ .two-col{grid-template-columns:1fr} }

  /* audit list */
  .audit-wrap{display:flex;flex-direction:column;gap:10px}
  .audit{background:#061426;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.03);font-size:14px;color:var(--muted)}
  .audit .title{font-weight:800;color:var(--ink);margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .attempts-badge{display:inline-block;background:#0f1a22;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.03);font-weight:800;color:var(--muted);margin-left:6px}
  ul.attempt-list{list-style:none;padding:0;margin:6px 0 0 0;max-height:150px;overflow:auto}
  ul.attempt-list li{padding:6px 8px;border-radius:6px;margin:6px 0;background:rgba(255,255,255,.01);display:flex;justify-content:space-between;gap:8px;font-size:14px}
  ul.attempt-list li .t{color:var(--muted);font-size:12px}
  ul.attempt-list li.success{background:rgba(20,61,47,.12);color:var(--ink)}
  ul.attempt-list li.failed{background:rgba(59,19,19,.08);color:var(--ink)}

  /* progress bar */
  .progress-wrap{margin-top:8px;display:none;flex-direction:column;gap:6px}
  .progress-bar{width:100%;height:10px;background:rgba(255,255,255,.03);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.03)}
  .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#ff6b6b,#b71c1c);transition:width .3s linear}
  .countdown-text{font-weight:800;color:#ffdede;font-size:14px}

  /* form */
  .form{margin-top:12px;display:flex;flex-direction:column;gap:12px}
  .input-wrap{display:flex;gap:10px}
  input[type="password"]{
    flex:1;padding:14px;border-radius:12px;border:1px solid var(--input-border);
    background:linear-gradient(180deg,var(--input-bg), #0b2831);
    color:var(--ink);font-size:16px;outline:none;box-shadow:inset 0 -6px 18px rgba(0,0,0,.25);
    transition:box-shadow .12s, border-color .12s, transform .06s;
  }
  input[type="password"]::placeholder{color:var(--input-placeholder)}
  input[type="password"]:focus{
    box-shadow:0 6px 28px rgba(183,28,28,.12), inset 0 -8px 18px rgba(0,0,0,.35);
    border-color:rgba(183,28,28,.75);
    transform:translateY(-1px);
  }
  button.primary{
    background:linear-gradient(180deg,var(--accent),#8b1414);color:white;border:none;padding:12px 16px;border-radius:10px;font-weight:800;font-size:16px;cursor:pointer;
  }
  button.primary:disabled{opacity:.6;cursor:not-allowed}

  .status{margin-top:8px;padding:10px;border-radius:8px;font-weight:700}
  .status.locked{background:var(--danger);color:#ffdede}
  .status.ok{background:var(--success);color:#bff0c9}
  .status.info{background:#0f2a38;color:var(--muted)}

  .help{font-size:13px;color:var(--muted);margin-top:8px}

  /* responsive */
  @media (max-width:900px){
    .audit{order:-1}
    .attempts-badge{font-size:15px}
    input[type="password"]{font-size:18px;padding:16px;border-radius:14px}
    button.primary{padding:14px;font-size:18px;border-radius:12px}
    .progress-wrap{display:flex} /* progress visible on mobile */
    .progress-bar{height:14px}
    .countdown-text{font-size:16px}
  }

  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <header class="banner" role="banner">
      <h1>GARDA SÍOCHÁNA — Investigator Access</h1>
      <small>CASE FILE 41165-43 — AUTHORIZED PERSONNEL ONLY</small>
    </header>

    <div class="panel" role="main" aria-labelledby="portalTitle">
      <div class="two-col">
        <!-- Left: main form & messages -->
        <section aria-labelledby="portalTitle">
          <h2 id="portalTitle" style="margin:0 0 8px 0">Enter Investigator Access Code</h2>
          <p class="lead">Enter your access code below to proceed to the restricted evidence portal. After three consecutive failed attempts the portal will lock for <strong>5 minutes</strong>.</p>

          <!-- Audit list (compact recent attempts) -->
          <div class="audit-wrap">
            <div class="audit" aria-live="polite" aria-atomic="true" id="auditBox">
              <div class="title">
                <span>Access Audit</span>
                <span><span id="attemptsBadge" class="attempts-badge">Attempts: 0</span></span>
              </div>

              <ul id="attemptList" class="attempt-list" aria-live="polite" aria-atomic="true">
                <!-- last 5 attempts will be inserted here -->
                <li class="small muted">No attempts recorded.</li>
              </ul>

              <!-- progress (countdown & bar) -->
              <div id="progressWrap" class="progress-wrap" aria-hidden="true">
                <div class="countdown-text" id="countdownText">Locked — 05:00 remaining</div>
                <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                  <div id="progressFill" class="progress-fill"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Form -->
          <form id="accessForm" class="form" onsubmit="return false" aria-describedby="accessHelp">
            <label for="code" class="small" style="font-weight:700">Access Code</label>
            <div class="input-wrap">
              <input id="code" type="password"
                     placeholder="Enter access code here"
                     aria-label="Enter access code here"
                     autocomplete="off"
                     autocapitalize="off"
                     autocorrect="off"
                     spellcheck="false" />
              <button id="submit" class="primary" type="button">Enter</button>
            </div>

            <div id="msg" class="status info" style="display:none" role="alert"></div>

            <div id="accessHelp" class="help">Successful authentication will forward you to the restricted evidence portal. The portal locks for 5 minutes after 3 consecutive failed attempts.</div>
          </form>
        </section>

        <!-- Right: quick status -->
        <aside>
          <h3 style="margin:0 0 6px 0;color:var(--muted)">Authentication — Investigator</h3>
          <div class="small">Access Level: <strong>RESTRICTED</strong></div>
          <div class="small" style="margin-top:6px">Case ID: <strong>41165-43</strong></div>
          <div style="margin-top:12px" class="small">Lock policy: <strong>3 failed attempts</strong> → <strong>5 minute lock</strong></div>

          <div id="statusBox" style="margin-top:12px" class="small"></div>
          <div style="margin-top:12px"><a class="small" href="index.html">Return to Case File — Open Catalogue</a></div>
        </aside>
      </div>
    </div>
  </div>

<script>
/*
  Access page with:
   - compact last-5 attempt list (timestamp + status)
   - mobile progress bar & countdown during lock
   - clears attempt log after successful login
   - synced across tabs via storage events
*/
document.addEventListener('DOMContentLoaded', ()=> {
  const PASSWORD = "murder123";
  const redirectTo = "restricted.html";
  const maxAttempts = 3;
  const lockSeconds = 300; // 5 minutes

  const KEY_ATT = 'case_41165_43_attempts';
  const KEY_LOCK = 'case_41165_43_lockedUntil';
  const KEY_AUD = 'case_41165_43_audit_v2'; // using JSON structured array

  // DOM
  const input = document.getElementById('code');
  const btn = document.getElementById('submit');
  const attemptList = document.getElementById('attemptList');
  const attemptsBadge = document.getElementById('attemptsBadge');
  const msg = document.getElementById('msg');
  const statusBox = document.getElementById('statusBox');
  const progressWrap = document.getElementById('progressWrap');
  const progressFill = document.getElementById('progressFill');
  const countdownText = document.getElementById('countdownText');

  // helpers
  const nowTs = () => Date.now();

  function readAttempts(){
    return parseInt(localStorage.getItem(KEY_ATT) || '0', 10) || 0;
  }
  function readLockedUntil(){
    return parseInt(localStorage.getItem(KEY_LOCK) || '0', 10) || 0;
  }

  function readAuditArray(){
    const raw = localStorage.getItem(KEY_AUD) || '';
    if (!raw) return [];
    try {
      const arr = JSON.parse(raw);
      if (Array.isArray(arr)) return arr;
    } catch(e){
      // fallback parse of legacy storage (newline separated)
      try {
        const lines = raw.split('\n').filter(Boolean).map(line => ({ ts: Date.now(), msg: line }));
        return lines;
      } catch(e2){
        return [];
      }
    }
    return [];
  }

  function writeAuditArray(arr){
    try {
      localStorage.setItem(KEY_AUD, JSON.stringify(arr.slice(0,200))); // keep only up to 200 entries
    } catch(e){}
  }

  function pushAuditEntry(msgText){
    const arr = readAuditArray();
    const entry = { ts: Date.now(), msg: msgText };
    arr.unshift(entry);
    writeAuditArray(arr);
    renderAudit();
    attemptsBadge.textContent = 'Attempts: ' + readAttempts();
  }

  function renderAudit(){
    const arr = readAuditArray();
    const slice = arr.slice(0,5);
    attemptList.innerHTML = '';
    if (!slice.length){
      const li = document.createElement('li');
      li.className = 'small muted';
      li.textContent = 'No attempts recorded.';
      attemptList.appendChild(li);
      return;
    }
    slice.forEach(e=>{
      const li = document.createElement('li');
      const date = new Date(e.ts);
      const ts = date.toLocaleString();
      const lower = (e.msg || '').toLowerCase();
      if (lower.includes('failed')) li.classList.add('failed');
      if (lower.includes('success')) li.classList.add('success');

      const left = document.createElement('div');
      left.textContent = e.msg;
      const right = document.createElement('div'); right.className = 't'; right.textContent = ts;
      li.appendChild(left);
      li.appendChild(right);
      attemptList.appendChild(li);
    });
    attemptsBadge.textContent = 'Attempts: ' + readAttempts();
  }

  // initial render
  renderAudit();

  // UI updates for lock + progress bar
  function updateLockUI(){
    const lockedUntil = readLockedUntil();
    const now = nowTs();
    if (lockedUntil && now < lockedUntil){
      const remaining = Math.ceil((lockedUntil - now)/1000);
      const mins = Math.floor(remaining/60);
      const secs = remaining % 60;
      msg.style.display = '';
      msg.className = 'status locked';
      msg.textContent = `Portal locked: ${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')} remaining.`;
      input.disabled = true;
      btn.disabled = true;
      statusBox.textContent = 'LOCKED — too many failed attempts';

      const total = lockSeconds;
      const elapsed = total - remaining;
      const percent = Math.max(0, Math.min(100, (elapsed / total) * 100));
      progressFill.style.width = percent + '%';
      progressFill.setAttribute('aria-valuenow', Math.round(percent));
      progressWrap.setAttribute('aria-hidden','false');
      progressWrap.style.display = 'flex';
      countdownText.textContent = `Locked — ${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')} remaining`;
    } else {
      msg.style.display = 'none';
      input.disabled = false;
      btn.disabled = false;
      statusBox.textContent = '';
      progressWrap.setAttribute('aria-hidden','true');
      progressWrap.style.display = 'none';
      progressFill.style.width = '0%';
      if (lockedUntil && now >= lockedUntil) localStorage.removeItem(KEY_LOCK);
    }
    attemptsBadge.textContent = 'Attempts: ' + readAttempts();
    renderAudit();
  }

  // set lock
  function setLock(seconds){
    const until = nowTs() + seconds*1000;
    localStorage.setItem(KEY_LOCK, String(until));
    localStorage.setItem(KEY_ATT, '0');
    pushAuditEntry('LOCKED — too many failed attempts');
    updateLockUI();
  }

  // success handler: clear attempts and audit log
  function onSuccess(){
    localStorage.setItem(KEY_ATT,'0');
    localStorage.removeItem(KEY_AUD);
    renderAudit();
    msg.style.display = '';
    msg.className = 'status ok';
    msg.textContent = 'Access granted — redirecting…';
    setTimeout(()=> window.location.href = redirectTo, 700);
  }

  // fail handler
  function onFail(){
    const attempts = (readAttempts() || 0) + 1;
    localStorage.setItem(KEY_ATT, String(attempts));
    pushAuditEntry(`FAILED attempt ${attempts}`);
    msg.style.display = '';
    msg.className = 'status locked';
    msg.textContent = 'Incorrect access code.';
    input.value = '';
    input.focus();
    if (attempts >= maxAttempts) setLock(lockSeconds);
  }

  // wire UI
  btn.addEventListener('click', ()=> {
    const lockedUntil = readLockedUntil();
    if (lockedUntil && nowTs() < lockedUntil){ updateLockUI(); return; }
    const val = (input.value || '').trim();
    if (!val){ msg.style.display=''; msg.className='status locked'; msg.textContent='Enter a valid access code.'; input.focus(); return; }
    if (val === PASSWORD) onSuccess(); else onFail();
  });
  input.addEventListener('keyup', (e)=> { if (e.key === 'Enter') btn.click(); });

  // timers: update countdown/progress once per second
  updateLockUI();
  let intervalId = setInterval(updateLockUI, 1000);

  // keep UI in sync across tabs/windows
  window.addEventListener('storage', (ev)=> {
    if ([KEY_LOCK, KEY_ATT, KEY_AUD].includes(ev.key)){
      renderAudit();
      updateLockUI();
    }
  });

  window.addEventListener('pageshow', ()=> updateLockUI());
});
</script>
</body>
</html>
